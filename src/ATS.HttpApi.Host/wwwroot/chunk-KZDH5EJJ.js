import{a as Ae}from"./chunk-S6PFZDJB.js";import{X as Ne,Y as we,_ as Ee,ba as Ve,da as ke,ea as De,j as xe,k as be,l as he,m as ye,n as Fe,o as Te,p as Me,q as Se}from"./chunk-2KNHXYM4.js";import{B as de,Ga as Ce,Ja as fe,Ta as ve,Ya as j,c as le,d as pe,i as se,m as _e,pa as ge,t as ce,u as me,v as ue}from"./chunk-BDOQTSQV.js";import{$ as f,Ab as F,Ba as z,Bb as T,Cb as M,Da as J,Db as te,Eb as G,Fb as S,Ga as h,Ha as Q,I as H,Ib as $,Jb as N,Kb as ne,Lb as ie,Ma as Z,Ob as x,Pb as b,Qa as d,Ra as g,Sb as A,T as U,Ua as B,Va as L,W as Y,Wa as _,X as y,Xa as s,Y as X,Ya as p,Za as P,_ as C,ab as O,bb as v,cb as ee,gb as w,hb as l,pc as ae,qc as oe,ra as r,rb as k,tb as R,vc as re,wb as c,xb as D,yb as u}from"./chunk-KHY5JWQN.js";import{a as W,b as K}from"./chunk-R3EWYZZD.js";var Ie=(()=>{let a=class a{constructor(i){this.restService=i,this.apiName="AbpFeatureManagement",this.delete=(n,o)=>this.restService.request({method:"DELETE",url:"/api/feature-management/features",params:{providerName:n,providerKey:o}},{apiName:this.apiName}),this.get=(n,o)=>this.restService.request({method:"GET",url:"/api/feature-management/features",params:{providerName:n,providerKey:o}},{apiName:this.apiName}),this.update=(n,o,m)=>this.restService.request({method:"PUT",url:"/api/feature-management/features",params:{providerName:n,providerKey:o},body:m},{apiName:this.apiName})}};a.\u0275fac=function(n){return new(n||a)(Y(ge))},a.\u0275prov=U({token:a,factory:a.\u0275fac,providedIn:"root"});let e=a;return e})();var Pe=()=>({size:"lg"}),q=e=>({$implicit:e}),Oe=(e,a)=>a.name,Re=(e,a)=>a.id||e,We=(e,a)=>a.value;function Ke(e,a){if(e&1&&c(0),e&2){let t=l(3);u(" - ",t.providerTitle," ")}}function ze(e,a){if(e&1&&(s(0,"h3"),c(1),x(2,"abpLocalization"),d(3,Ke,1,1),p()),e&2){let t=l(2);r(),u(" ",b(2,2,"AbpFeatureManagement::Features")," "),r(2),g(t.providerTitle?3:-1)}}function Ge(e,a){if(e&1&&(s(0,"span"),c(1),p()),e&2){l(2);let t=S(0);r(),u("(",t,")")}}function $e(e,a){e&1&&O(0)}function je(e,a){if(e&1){let t=v();s(0,"div",21)(1,"input",22),M("ngModelChange",function(n){C(t);let o=l().$implicit;return T(o.value,n)||(o.value=n),f(n)}),w("ngModelChange",function(n){C(t);let o=l().$implicit,m=l(6);return f(m.onCheckboxClick(n,o))}),p(),s(2,"label",23),c(3),d(4,Ge,2,1,"span"),p(),h(5,$e,1,0,"ng-container",24),p()}if(e&2){let t=l().$implicit,i=S(1);l(3);let n=k(6);R("px-4",!!t.parentName),r(),_("id",t.name),F("ngModel",t.value),_("disabled",i),r(),_("htmlFor",t.name),r(),u(" ",t.displayName," "),r(),g(i?4:-1),r(),_("ngTemplateOutlet",n)("ngTemplateOutletContext",N(10,q,t.description))}}function qe(e,a){if(e&1&&(s(0,"span"),c(1),p()),e&2){l(2);let t=S(0);r(),u("(",t,")")}}function He(e,a){e&1&&O(0)}function Ue(e,a){if(e&1){let t=v();s(0,"div",25)(1,"label",26),c(2),d(3,qe,2,1,"span"),p(),s(4,"input",27),M("ngModelChange",function(n){C(t);let o=l().$implicit;return T(o.value,n)||(o.value=n),f(n)}),p(),h(5,He,1,0,"ng-container",24),p()}if(e&2){let t=l().$implicit,i=S(1);l(3);let n=k(6);R("px-2",!!t.parentName),r(),_("htmlFor",t.name),r(),u(" ",t.displayName," "),r(),g(i?3:-1),r(),_("id",t.name),F("ngModel",t.value),_("abpFeatureManagementFreeText",t)("disabled",i),r(),_("ngTemplateOutlet",n)("ngTemplateOutletContext",N(11,q,t.description))}}function Ye(e,a){if(e&1&&(s(0,"span"),c(1),p()),e&2){l(3);let t=S(0);r(),u("(",t,")")}}function Xe(e,a){if(e&1&&(s(0,"option",29),c(1),x(2,"abpLocalization"),p()),e&2){let t=a.$implicit;_("ngValue",t.value),r(),u(" ",b(2,2,(t.displayText==null?null:t.displayText.resourceName)+"::"+(t.displayText==null?null:t.displayText.name))," ")}}function Je(e,a){e&1&&O(0)}function Qe(e,a){if(e&1){let t=v();s(0,"div",25)(1,"label",26),c(2),d(3,Ye,2,1,"span"),p(),s(4,"select",28),M("ngModelChange",function(n){C(t);let o=l(2).$implicit;return T(o.value,n)||(o.value=n),f(n)}),B(5,Xe,3,4,"option",29,We),p(),h(7,Je,1,0,"ng-container",24),p()}if(e&2){let t=l(2).$implicit,i=S(1);l(3);let n=k(6);R("px-2",!!t.parentName),r(),_("htmlFor",t.name),r(),u(" ",t.displayName," "),r(),g(i?3:-1),r(),_("id",t.name),F("ngModel",t.value),_("disabled",i),r(),L(t.valueType.itemSource==null?null:t.valueType.itemSource.items),r(2),_("ngTemplateOutlet",n)("ngTemplateOutletContext",N(10,q,t.description))}}function Ze(e,a){if(e&1&&d(0,Qe,8,12,"div",20),e&2){let t=l().$implicit;g(!(t.valueType.itemSource==null||t.valueType.itemSource.items==null)&&t.valueType.itemSource.items.length?0:-1)}}function et(e,a){if(e&1&&c(0),e&2){let t=l().$implicit;u(" ",t.displayName," ")}}function tt(e,a){if(e&1){let t=v();te(0)(1),s(2,"div",18),w("keyup.enter",function(){C(t);let n=l(6);return f(n.save())}),d(3,je,6,12,"div",19)(4,Ue,6,13,"div",20)(5,Ze,1,1)(6,et,1,1),p()}if(e&2){let t,i=a.$implicit,n=l(2).$implicit,o=l(4),m=G(i.provider.name);r(),G(i.parentName?m!==o.providerName&&m!==o.defaultProviderName:o.isParentDisabled(i.name,n.name,m)),r(),_("ngStyle",i.style),r(),g((t=i.valueType==null?null:i.valueType.name)===o.valueTypes.ToggleStringValueType?3:t===o.valueTypes.FreeTextStringValueType?4:t===o.valueTypes.SelectionStringValueType?5:6)}}function nt(e,a){if(e&1&&(s(0,"h4"),c(1),p(),P(2,"hr",16),B(3,tt,7,4,"div",17,Re)),e&2){let t=l().$implicit,i=l(4);r(),D(i.selectedGroupDisplayName),r(2),L(i.features[t.name])}}function it(e,a){if(e&1&&(s(0,"li",11)(1,"a",14),c(2),p(),h(3,nt,5,1,"ng-template",15),p()),e&2){let t=a.$implicit;_("ngbNavItem",t.displayName),r(2),D(t.displayName)}}function at(e,a){if(e&1&&(s(0,"small",30),c(1),p()),e&2){let t=l().$implicit;r(),D(t)}}function ot(e,a){if(e&1&&d(0,at,2,1,"small",30),e&2){let t=a.$implicit;g(t?0:-1)}}function rt(e,a){if(e&1){let t=v();s(0,"div",9)(1,"ul",10,3),M("activeIdChange",function(n){C(t);let o=l(3);return T(o.selectedGroupDisplayName,n)||(o.selectedGroupDisplayName=n),f(n)}),B(3,it,4,2,"li",11,Oe),p()(),h(5,ot,1,1,"ng-template",null,4,A),s(7,"div",12),P(8,"div",13),p()}if(e&2){let t=k(2),i=l(3);r(),F("activeId",i.selectedGroupDisplayName),r(2),L(i.groups),r(5),_("ngbNavOutlet",t)}}function lt(e,a){e&1&&(s(0,"div",8),c(1),x(2,"abpLocalization"),p()),e&2&&(r(),u(" ",b(2,1,"AbpFeatureManagement::NoFeatureFoundMessage")," "))}function pt(e,a){if(e&1&&(s(0,"div",7),d(1,rt,9,2),d(2,lt,3,3,"div",8),p()),e&2){let t=l(2);r(),g(t.groups.length?1:-1),r(),g(t.groups.length?-1:2)}}function st(e,a){if(e&1){let t=v();s(0,"abp-button",34),w("click",function(){C(t);let n=l(3);return f(n.resetToDefault())}),c(1),x(2,"abpLocalization"),p()}if(e&2){let t=l(3);_("disabled",t.modalBusy),r(),u(" ",b(2,2,"AbpFeatureManagement::ResetToDefault")," ")}}function _t(e,a){if(e&1){let t=v();s(0,"abp-button",35),w("click",function(){C(t);let n=l(3);return f(n.save())}),c(1),x(2,"abpLocalization"),p()}if(e&2){let t=l(3);_("disabled",t.modalBusy),r(),u(" ",b(2,2,"AbpFeatureManagement::Save")," ")}}function ct(e,a){if(e&1&&(s(0,"button",31),c(1),x(2,"abpLocalization"),p(),d(3,st,3,4,"abp-button",32),d(4,_t,3,4,"abp-button",33)),e&2){let t=l(2);r(),u(" ",b(2,3,"AbpFeatureManagement::Cancel")," "),r(2),g(t.groups.length?3:-1),r(),g(t.groups.length?4:-1)}}function mt(e,a){if(e&1){let t=v();s(0,"abp-modal",6),M("visibleChange",function(n){C(t);let o=l();return T(o.visible,n)||(o.visible=n),f(n)}),h(1,ze,4,4,"ng-template",null,0,A)(3,pt,3,2,"ng-template",null,1,A)(5,ct,5,5,"ng-template",null,2,A),p()}if(e&2){let t=l();F("visible",t.visible),_("busy",t.modalBusy)("options",$(3,Pe))}}var ut=()=>({value:"T"}),dt=e=>({value:e}),gt=e=>({value:e,twoWay:!0}),Ct=(e,a,t)=>({providerName:e,providerKey:a,visible:t}),ft=e=>({visibleChange:e}),vt=(e,a)=>({inputs:e,outputs:a,componentKey:"FeatureManagement.FeatureManagementComponent"});function xt(e,a){if(e&1){let t=v();s(0,"abp-feature-management",5),M("visibleChange",function(n){C(t);let o=l(2);return T(o.visibleFeatures,n)||(o.visibleFeatures=n),f(n)}),p()}if(e&2){let t=l(2);F("visible",t.visibleFeatures),_("providerKey",t.providerKey)}}function bt(e,a){if(e&1&&h(0,xt,1,2,"abp-feature-management",4),e&2){let t=l();_("abpReplaceableTemplate",ne(12,vt,ie(6,Ct,$(1,ut),N(2,dt,t.providerKey),N(4,gt,t.visibleFeatures)),N(10,ft,t.onVisibleFeaturesChange)))}}var Be={numeric:"number",default:"text"},ht=(()=>{let a=class a{set feature(i){this._feature=i,this.setInputType()}get feature(){return this._feature}setInputType(){let i=this.feature?.valueType?.validator?.name.toLowerCase();this.type=Be[i]??Be.default}};a.\u0275fac=function(n){return new(n||a)},a.\u0275dir=J({type:a,selectors:[["input","abpFeatureManagementFreeText",""]],hostVars:1,hostBindings:function(n,o){n&2&&ee("type",o.type)},inputs:{feature:[0,"abpFeatureManagementFreeText","feature"]},exportAs:["inputAbpFeatureManagementFreeText"]});let e=a;return e})(),I=(function(e){return e.ToggleStringValueType="ToggleStringValueType",e.FreeTextStringValueType="FreeTextStringValueType",e.SelectionStringValueType="SelectionStringValueType",e})(I||{}),yt="D",Ft=(()=>{let a=class a{constructor(){this.track=y(Ce),this.toasterService=y(Ve),this.service=y(Ie),this.configState=y(fe),this.confirmationService=y(Ee),this.groups=[],this.valueTypes=I,this.defaultProviderName=yt,this.visibleChange=new Q,this.modalBusy=!1}get visible(){return this._visible}set visible(i){if(this._visible!==i&&(this._visible=i,this.visibleChange.emit(i),i)){this.openModal();return}}openModal(){if(!this.providerName)throw new Error("providerName is required.");this.getFeatures()}getFeatures(){this.service.get(this.providerName,this.providerKey).subscribe(i=>{i.groups?.length&&(this.groups=i.groups.map(({name:n,displayName:o})=>({name:n,displayName:o})),this.selectedGroupDisplayName=this.groups[0].displayName,this.features=i.groups.reduce((n,o)=>K(W({},n),{[o.name]:Tt(o.features,document.body.dir)}),{}))})}save(){if(this.modalBusy)return;let i=[];if(Object.keys(this.features).forEach(n=>{this.features[n].forEach(o=>{o.value!==o.initialValue&&i.push({name:o.name,value:`${o.value}`})})}),!i.length){this.visible=!1;return}this.modalBusy=!0,this.service.update(this.providerName,this.providerKey,{features:i}).pipe(H(()=>this.modalBusy=!1)).subscribe(()=>{this.visible=!1,this.toasterService.success("AbpUi::SavedSuccessfully"),this.providerKey||this.configState.refreshAppState().subscribe()})}resetToDefault(){this.confirmationService.warn("AbpFeatureManagement::AreYouSureToResetToDefault","AbpFeatureManagement::AreYouSure").subscribe(i=>{i===we.Status.confirm&&this.service.delete(this.providerName,this.providerKey).subscribe(()=>{this.toasterService.success("AbpFeatureManagement::ResetedToDefault"),this.visible=!1,this.providerKey||this.configState.refreshAppState().subscribe()})})}onCheckboxClick(i,n){i?this.checkToggleAncestors(n):this.uncheckToggleDescendants(n)}isParentDisabled(i,n,o){let m=this.features[n]?.filter(E=>E.parentName===i);return m?.length?m.some(E=>{let V=E.provider?.name;return V!==this.providerName&&V!==this.defaultProviderName||o!==this.providerName&&o!==this.defaultProviderName}):o!==this.providerName&&o!==this.defaultProviderName}uncheckToggleDescendants(i){this.findAllDescendantsOfByType(i,I.ToggleStringValueType).forEach(n=>this.setFeatureValue(n,!1))}checkToggleAncestors(i){this.findAllAncestorsOfByType(i,I.ToggleStringValueType).forEach(n=>this.setFeatureValue(n,!0))}findAllAncestorsOfByType(i,n){let o=this.findParentByType(i,n),m=[];for(;o;)m.push(o),o=this.findParentByType(o,n);return m}findAllDescendantsOfByType(i,n){let o=[],m=[i];for(;m.length;){let E=m.pop(),V=this.findChildrenByType(E,n);o.push(...V),m.push(...V)}return o}findParentByType(i,n){return this.getCurrentGroup().find(o=>o.valueType.name===n&&o.name===i.parentName)}findChildrenByType(i,n){return this.getCurrentGroup().filter(o=>o.valueType.name===n&&o.parentName===i.name)}getCurrentGroup(){return this.features[this.selectedGroupDisplayName]??[]}setFeatureValue(i,n){i.value=n}};a.\u0275fac=function(n){return new(n||a)},a.\u0275cmp=z({type:a,selectors:[["abp-feature-management"]],inputs:{providerKey:"providerKey",providerName:"providerName",providerTitle:"providerTitle",visible:"visible"},outputs:{visibleChange:"visibleChange"},exportAs:["abpFeatureManagement"],decls:1,vars:1,consts:[["abpHeader",""],["abpBody",""],["abpFooter",""],["nav","ngbNav"],["descTmp",""],[3,"visible","busy","options"],[3,"visibleChange","visible","busy","options"],[1,"row"],[1,"col"],[1,"col-md-4"],["ngbNav","","orientation","vertical",1,"nav-pills",3,"activeIdChange","activeId"],[3,"ngbNavItem"],[1,"col-md-8"],[1,"py-0",3,"ngbNavOutlet"],["ngbNavLink",""],["ngbNavContent",""],[1,"mt-2","mb-3"],[1,"mt-2",3,"ngStyle"],[1,"mt-2",3,"keyup.enter","ngStyle"],[1,"form-check",3,"px-4"],[1,"mb-3","form-group",3,"px-2"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"ngModelChange","id","ngModel","disabled"],[1,"form-check-label",3,"htmlFor"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"mb-3","form-group"],[1,"form-label",3,"htmlFor"],["type","text",1,"form-control",3,"ngModelChange","id","ngModel","abpFeatureManagementFreeText","disabled"],[1,"form-select",3,"ngModelChange","id","ngModel","disabled"],[3,"ngValue"],[1,"d-block","form-text","text-muted"],["abpClose","","type","button",1,"btn","btn-link"],["buttonClass","btn btn-outline-primary","aria-hidden","true",3,"disabled"],["iconClass","fa fa-check","aria-hidden","true",3,"disabled"],["buttonClass","btn btn-outline-primary","aria-hidden","true",3,"click","disabled"],["iconClass","fa fa-check","aria-hidden","true",3,"click","disabled"]],template:function(n,o){n&1&&d(0,mt,7,4,"abp-modal",5),n&2&&g(o.visible?0:-1)},dependencies:[re,oe,ae,Ne,ke,j,de,me,ue,pe,le,ce,se,_e,Se,xe,ye,he,be,Te,Fe,Me,ht,De],encapsulation:2});let e=a;return e})();function Tt(e,a){let t=`margin-${a==="rtl"?"right":"left"}.px`;return e.map(i=>{let n=i.valueType?.name===I.ToggleStringValueType?(i.value||"").toLowerCase()==="true":i.value;return K(W({},i),{value:n,initialValue:n,style:{[t]:i.depth*20}})})}var Mt=(()=>{let a=class a{constructor(){this.visibleFeatures=!1,this.onVisibleFeaturesChange=i=>{this.visibleFeatures=i}}openFeaturesModal(){this.visibleFeatures=!0}};a.\u0275fac=function(n){return new(n||a)},a.\u0275cmp=z({type:a,selectors:[["abp-feature-management-tab"]],decls:8,vars:7,consts:[[1,"pt-2","text-wrap"],["type","button",1,"btn","btn-primary",3,"click"],["aria-hidden","true",1,"me-1","fa","fa-cog"],["providerName","T",3,"visible","providerKey"],["providerName","T",3,"visible","providerKey","visibleChange",4,"abpReplaceableTemplate"],["providerName","T",3,"visibleChange","visible","providerKey"]],template:function(n,o){n&1&&(s(0,"p",0),c(1),x(2,"abpLocalization"),p(),s(3,"button",1),w("click",function(){return o.openFeaturesModal()}),P(4,"i",2),c(5),x(6,"abpLocalization"),p(),d(7,bt,1,15,"abp-feature-management",3)),n&2&&(r(),D(b(2,3,"AbpFeatureManagement::ManageHostFeaturesText")),r(4),u(" ",b(6,5,"AbpFeatureManagement::ManageHostFeatures"),`
`),r(2),g(o.visibleFeatures?7:-1))},dependencies:[ve,j,Ft],encapsulation:2});let e=a;return e})(),St=[Z(()=>{Nt()})];function Nt(){y(Ae).add([{name:"AbpFeatureManagement::Permission:FeatureManagement",order:100,requiredPolicy:"FeatureManagement.ManageHostFeatures",component:Mt}])}function Jt(){return X([St])}export{Ft as a,Jt as b};
