import{a as z}from"./chunk-FMX7EPKG.js";import{_ as q,ba as R}from"./chunk-2KNHXYM4.js";import{C as $,c as O,d as w,f as A,i as N,j as T,n as L,q as P,s as V,y as j,z as G}from"./chunk-BDOQTSQV.js";import{$ as g,Ba as S,Ga as b,Wa as m,Xa as e,Ya as t,Za as c,Zc as F,_ as h,bb as C,gb as u,hb as f,lc as D,nc as M,oc as I,ra as o,sb as E,tb as x,vc as k,wb as i,xa as _,xb as v,yb as y}from"./chunk-KHY5JWQN.js";import"./chunk-R3EWYZZD.js";function B(r,s){r&1&&(e(0,"div",34)(1,"div",35)(2,"span",36),i(3,"Loading..."),t()()())}function H(r,s){if(r&1&&(e(0,"span"),i(1),t()),r&2){let l=f().$implicit;o(),v(l.headName)}}function J(r,s){r&1&&(e(0,"span",4),i(1,"Not assigned"),t())}function U(r,s){if(r&1){let l=C();e(0,"tr")(1,"td")(2,"strong"),i(3),t()(),e(4,"td")(5,"span",44),i(6),t()(),e(7,"td"),i(8),t(),e(9,"td"),b(10,H,2,1,"span",32)(11,J,2,0,"span",45),t(),e(12,"td")(13,"span",46),i(14),t()(),e(15,"td")(16,"span",47),i(17),t()(),e(18,"td")(19,"button",48),u("click",function(){let d=h(l).$implicit,n=f(2);return g(n.openEditModal(d))}),c(20,"i",49),t(),e(21,"button",50),u("click",function(){let d=h(l).$implicit,n=f(2);return g(n.deleteDepartment(d))}),c(22,"i",51),t()()()}if(r&2){let l=s.$implicit;o(3),v(l.name),o(3),v(l.code||"N/A"),o(2),v(l.description||"-"),o(2),m("ngIf",l.headName),o(),m("ngIf",!l.headName),o(3),y("",l.jobCount||0," jobs"),o(2),m("ngClass",l.isActive?"bg-success":"bg-danger"),o(),y(" ",l.isActive?"Active":"Inactive"," ")}}function K(r,s){if(r&1&&(e(0,"div",37)(1,"div",38)(2,"div",39)(3,"div",40)(4,"div",41)(5,"table",42)(6,"thead")(7,"tr")(8,"th"),i(9,"Name"),t(),e(10,"th"),i(11,"Code"),t(),e(12,"th"),i(13,"Description"),t(),e(14,"th"),i(15,"Head"),t(),e(16,"th"),i(17,"Jobs"),t(),e(18,"th"),i(19,"Status"),t(),e(20,"th"),i(21,"Actions"),t()()(),e(22,"tbody"),b(23,U,23,8,"tr",43),t()()()()()()()),r&2){let l=f();o(23),m("ngForOf",l.departments)}}function Q(r,s){if(r&1){let l=C();e(0,"div",52),c(1,"i",53),e(2,"h3"),i(3,"No Departments Found"),t(),e(4,"p",4),i(5,"Get started by adding your first department."),t(),e(6,"button",54),u("click",function(){h(l);let d=f();return g(d.openCreateModal())}),c(7,"i",7),i(8," Add Department "),t()()}}function W(r,s){if(r&1&&(e(0,"span"),i(1),t()),r&2){let l=f();o(),v(l.isEditMode?"Update":"Create")}}function X(r,s){r&1&&(e(0,"span"),c(1,"span",55),i(2,"Saving... "),t())}function Y(r,s){if(r&1&&c(0,"div",56),r&2){let l=f();x("show",l.isModalOpen)}}var de=(()=>{let s=class s{constructor(a,d,n,p){this.departmentService=a,this.fb=d,this.toaster=n,this.confirmation=p,this.departments=[],this.loading=!1,this.isModalOpen=!1,this.isEditMode=!1,this.submitting=!1,this.selectedDepartmentId=null,this.initForm()}ngOnInit(){this.loadDepartments()}initForm(){this.departmentForm=this.fb.group({name:["",A.required],code:[""],description:[""],isActive:[!0]})}loadDepartments(){this.loading=!0,this.departmentService.getAllActive().subscribe({next:a=>{this.departments=a,this.loading=!1},error:a=>{console.error("Failed to load departments:",a),this.toaster.error("Failed to load departments"),this.loading=!1}})}openCreateModal(){this.isEditMode=!1,this.selectedDepartmentId=null,this.departmentForm.reset({isActive:!0}),this.isModalOpen=!0}openEditModal(a){this.isEditMode=!0,this.selectedDepartmentId=a.id,this.departmentForm.patchValue({name:a.name,code:a.code,description:a.description,isActive:a.isActive}),this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.departmentForm.reset()}isFieldInvalid(a){let d=this.departmentForm.get(a);return!!(d&&d.invalid&&(d.dirty||d.touched))}saveDepartment(){if(this.departmentForm.invalid){Object.keys(this.departmentForm.controls).forEach(p=>{this.departmentForm.get(p)?.markAsTouched()});return}this.submitting=!0;let a=this.departmentForm.value,d={name:a.name,code:a.code||void 0,description:a.description||void 0,isActive:a.isActive,headId:void 0,headName:void 0,headEmail:void 0,parentDepartmentId:void 0};(this.isEditMode?this.departmentService.update(this.selectedDepartmentId,d):this.departmentService.create(d)).subscribe({next:()=>{this.toaster.success(this.isEditMode?"Department updated successfully":"Department created successfully"),this.closeModal(),this.loadDepartments(),this.submitting=!1},error:p=>{console.error("Failed to save department:",p),this.toaster.error(p.error?.error?.message||"Failed to save department"),this.submitting=!1}})}deleteDepartment(a){this.confirmation.warn(`Are you sure you want to delete the department "${a.name}"?`,"Delete Department").subscribe(d=>{d&&this.departmentService.delete(a.id).subscribe({next:()=>{this.toaster.success("Department deleted successfully"),this.loadDepartments()},error:n=>{console.error("Failed to delete department:",n),this.toaster.error(n.error?.error?.message||"Failed to delete department. It may have associated jobs.")}})})}};s.\u0275fac=function(d){return new(d||s)(_(z),_(G),_(R),_(q))},s.\u0275cmp=S({type:s,selectors:[["app-department-list"]],decls:49,vars:15,consts:[[1,"container-fluid","py-4"],[1,"row","mb-4"],[1,"col"],[1,"h2","mb-3"],[1,"text-muted"],[1,"col-auto"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-plus","me-2"],["class","text-center py-5",4,"ngIf"],["class","row",4,"ngIf"],["class","empty-state text-center py-5",4,"ngIf"],["tabindex","-1",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[3,"ngSubmit","formGroup"],[1,"modal-body"],[1,"mb-3"],[1,"form-label","required"],["type","text","formControlName","name",1,"form-control"],[1,"invalid-feedback"],[1,"form-label"],["type","text","formControlName","code","placeholder","e.g., ENG","maxlength","50",1,"form-control"],["formControlName","description","rows","3","maxlength","500",1,"form-control"],[1,"form-check"],["type","checkbox","formControlName","isActive","id","isActive",1,"form-check-input"],["for","isActive",1,"form-check-label"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],[4,"ngIf"],["class","modal-backdrop fade",3,"show",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"row"],[1,"col-12"],[1,"card","shadow-sm"],[1,"card-body"],[1,"table-responsive"],[1,"table","table-hover"],[4,"ngFor","ngForOf"],[1,"badge","bg-secondary"],["class","text-muted",4,"ngIf"],[1,"badge","bg-info"],[1,"badge",3,"ngClass"],[1,"btn","btn-sm","btn-outline-primary","me-1",3,"click"],[1,"fas","fa-edit"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"fas","fa-trash"],[1,"empty-state","text-center","py-5"],[1,"fas","fa-sitemap","fa-4x","text-muted","mb-3"],[1,"btn","btn-primary","mt-3",3,"click"],[1,"spinner-border","spinner-border-sm","me-1"],[1,"modal-backdrop","fade"]],template:function(d,n){d&1&&(e(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),i(4,"Departments"),t(),e(5,"p",4),i(6,"Manage organizational departments"),t()(),e(7,"div",5)(8,"button",6),u("click",function(){return n.openCreateModal()}),c(9,"i",7),i(10," Add Department "),t()()(),b(11,B,4,0,"div",8)(12,K,24,1,"div",9)(13,Q,9,0,"div",10),t(),e(14,"div",11)(15,"div",12)(16,"div",13)(17,"div",14)(18,"h5",15),i(19),t(),e(20,"button",16),u("click",function(){return n.closeModal()}),t()(),e(21,"form",17),u("ngSubmit",function(){return n.saveDepartment()}),e(22,"div",18)(23,"div",19)(24,"label",20),i(25,"Name"),t(),c(26,"input",21),e(27,"div",22),i(28,"Department name is required"),t()(),e(29,"div",19)(30,"label",23),i(31,"Code"),t(),c(32,"input",24),t(),e(33,"div",19)(34,"label",23),i(35,"Description"),t(),c(36,"textarea",25),t(),e(37,"div",19)(38,"div",26),c(39,"input",27),e(40,"label",28),i(41," Active "),t()()()(),e(42,"div",29)(43,"button",30),u("click",function(){return n.closeModal()}),i(44,"Cancel"),t(),e(45,"button",31),b(46,W,2,1,"span",32)(47,X,3,0,"span",32),t()()()()()(),b(48,Y,1,2,"div",33)),d&2&&(o(11),m("ngIf",n.loading),o(),m("ngIf",!n.loading&&n.departments.length>0),o(),m("ngIf",!n.loading&&n.departments.length===0),o(),E("display",n.isModalOpen?"block":"none"),x("show",n.isModalOpen),o(5),v(n.isEditMode?"Edit Department":"New Department"),o(2),m("formGroup",n.departmentForm),o(5),x("is-invalid",n.isFieldInvalid("name")),o(19),m("disabled",n.departmentForm.invalid||n.submitting),o(),m("ngIf",!n.submitting),o(),m("ngIf",n.submitting),o(),m("ngIf",n.isModalOpen))},dependencies:[k,D,M,I,F,$,L,w,O,N,T,j,P,V],styles:['.card[_ngcontent-%COMP%]{border-radius:12px}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;color:#495057;border-bottom:2px solid #dee2e6}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{transition:background-color .2s}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}.empty-state[_ngcontent-%COMP%]{padding:3rem}.modal.show[_ngcontent-%COMP%]{background-color:#00000080}.modal-backdrop.show[_ngcontent-%COMP%]{opacity:.5}.form-label.required[_ngcontent-%COMP%]:after{content:" *";color:#dc3545}']});let r=s;return r})();export{de as DepartmentListComponent};
