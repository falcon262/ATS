import{U as Se,X as ve,ba as Ee,da as he,ea as Te}from"./chunk-2KNHXYM4.js";import{A as oe,C as re,Da as ue,Ea as z,Ja as B,Ka as fe,N as me,P as se,Q as le,Sa as ge,T as pe,Ya as be,c as Q,d as X,f as T,i as Z,ia as ce,j as ee,n as te,o as ie,pa as de,q as ne,s as ae}from"./chunk-BDOQTSQV.js";import{$ as v,Ab as H,B as L,Ba as U,Bb as $,Cb as W,Ga as D,I as P,Ib as Y,Kb as K,Ma as E,Ob as s,Pb as l,Qa as k,Ra as q,Sb as I,T as M,V as x,W as G,Wa as g,X as f,Xa as a,Y as j,Ya as n,Za as d,_ as S,aa as O,bb as h,gb as _,ha as R,hb as b,o as F,p as V,ra as r,vc as J,wb as m,xa as y,xb as u,yb as A}from"./chunk-KHY5JWQN.js";import{a as N}from"./chunk-R3EWYZZD.js";var Ne=(()=>{let e=class e{constructor(i){this.restService=i,this.apiName="SettingManagement",this.get=o=>this.restService.request({method:"GET",url:"/api/setting-management/emailing"},N({apiName:this.apiName},o)),this.sendTestEmail=(o,p)=>this.restService.request({method:"POST",url:"/api/setting-management/emailing/send-test-email",body:o},N({apiName:this.apiName},p)),this.update=(o,p)=>this.restService.request({method:"POST",url:"/api/setting-management/emailing",body:o},N({apiName:this.apiName},p))}};e.\u0275fac=function(o){return new(o||e)(G(de))},e.\u0275prov=M({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var Fe=()=>({time:"200ms",easing:"linear"}),Ge=(t,e)=>({value:t,params:e});function De(t,e){if(t&1){let c=h();a(0,"button",24),_("click",function(){S(c);let o=b(2);return v(o.openSendEmailModal())}),d(1,"i",25),m(2),s(3,"abpLocalization"),n()}t&2&&(r(2),A(" ",l(3,1,"AbpSettingManagement::SendTestEmail")," "))}function ze(t,e){if(t&1){let c=h();a(0,"form",5),_("ngSubmit",function(){S(c);let o=b();return v(o.submit())}),a(1,"div",6)(2,"label",7),m(3),s(4,"abpLocalization"),a(5,"span",8),m(6,"*"),n()(),d(7,"input",9),n(),a(8,"div",6)(9,"label",7),m(10),s(11,"abpLocalization"),a(12,"span",8),m(13,"*"),n()(),d(14,"input",10),n(),a(15,"div",6)(16,"label",7),m(17),s(18,"abpLocalization"),n(),d(19,"input",11),n(),a(20,"div",6)(21,"label",7),m(22),s(23,"abpLocalization"),a(24,"span",8),m(25,"*"),n()(),d(26,"input",12),n(),a(27,"div",13),d(28,"input",14),a(29,"label",15),m(30),s(31,"abpLocalization"),n()(),a(32,"div",13),d(33,"input",16),a(34,"label",17),m(35),s(36,"abpLocalization"),n()(),a(37,"div")(38,"div",6)(39,"label",7),m(40),s(41,"abpLocalization"),n(),d(42,"input",18),n(),a(43,"div",6)(44,"label",7),m(45),s(46,"abpLocalization"),n(),d(47,"input",19),n(),a(48,"div",20)(49,"label",7),m(50),s(51,"abpLocalization"),n(),d(52,"input",21),n()(),d(53,"hr"),a(54,"abp-button",22),m(55),s(56,"abpLocalization"),n(),D(57,De,4,3,"button",23),n()}if(t&2){let c,i=b();g("formGroup",i.form)("validateOnSubmit",!0),r(3),u(l(4,14,"AbpSettingManagement::DefaultFromDisplayName")),r(7),u(l(11,16,"AbpSettingManagement::DefaultFromAddress")),r(7),u(l(18,18,"AbpSettingManagement::SmtpHost")),r(5),u(l(23,20,"AbpSettingManagement::SmtpPort")),r(8),u(l(31,22,"AbpSettingManagement::SmtpEnableSsl")),r(5),u(l(36,24,"AbpSettingManagement::SmtpUseDefaultCredentials")),r(2),g("@collapse",K(35,Ge,(c=i.form.get("smtpUseDefaultCredentials"))!=null&&c.value?"collapsed":"expanded",Y(34,Fe))),r(3),u(l(41,26,"AbpSettingManagement::SmtpDomain")),r(5),u(l(46,28,"AbpSettingManagement::SmtpUserName")),r(5),u(l(51,30,"AbpSettingManagement::SmtpPassword")),r(5),A(" ",l(56,32,"AbpSettingManagement::Save")," "),r(2),g("abpPermission",i.emailingPolicy)}}function Be(t,e){t&1&&(a(0,"h3"),m(1),s(2,"abpLocalization"),n()),t&2&&(r(),u(l(2,1,"AbpSettingManagement::SendTestEmail")))}function we(t,e){if(t&1){let c=h();a(0,"form",26),_("ngSubmit",function(){S(c);let o=b();return v(o.emailTestFormSubmit())}),a(1,"div",6)(2,"label",7),m(3),s(4,"abpLocalization"),n(),d(5,"input",27),n(),a(6,"div",6)(7,"label",7),m(8),s(9,"abpLocalization"),n(),d(10,"input",28),n(),a(11,"div",6)(12,"label",7),m(13),s(14,"abpLocalization"),n(),d(15,"input",29),n(),a(16,"div",6)(17,"label",7),m(18),s(19,"abpLocalization"),n(),d(20,"textarea",30),n()()}if(t&2){let c=b();g("formGroup",c.emailTestForm),r(3),u(l(4,5,"AbpSettingManagement::SenderEmailAddress")),r(5),u(l(9,7,"AbpSettingManagement::TargetEmailAddress")),r(5),u(l(14,9,"AbpSettingManagement::Subject")),r(5),u(l(19,11,"AbpSettingManagement::Body"))}}function Ve(t,e){if(t&1&&(a(0,"abp-button",31)(1,"span"),m(2),s(3,"abpLocalization"),n()(),a(4,"button",32),m(5),s(6,"abpLocalization"),n()),t&2){let c=b();g("disabled",c.emailTestForm.invalid&&c.emailTestForm.dirty),r(2),u(l(3,3,"AbpSettingManagement::Send")),r(3),A(" ",l(6,5,"AbpUi::Close")," ")}}var{required:w,email:Me}=T,Le=(()=>{let e=class e{constructor(i,o,p){this.emailSettingsService=i,this.fb=o,this.toasterService=p,this.localizationService=f(fe),this.configStateSevice=f(B),this.currentUserEmail=pe(this.configStateSevice.getDeep$(["currentUser","email"])),this.saving=!1,this.emailingPolicy="SettingManagement.Emailing",this.isEmailTestModalOpen=!1,this.modalSize={size:"lg"}}ngOnInit(){this.getData()}getData(){this.emailSettingsService.get().subscribe(i=>{this.buildForm(i)})}buildForm(i){this.form=this.fb.group({defaultFromDisplayName:[i.defaultFromDisplayName,[T.required]],defaultFromAddress:[i.defaultFromAddress,[T.required]],smtpHost:[i.smtpHost],smtpPort:[i.smtpPort,[T.required]],smtpEnableSsl:[i.smtpEnableSsl],smtpUseDefaultCredentials:[i.smtpUseDefaultCredentials],smtpDomain:[i.smtpDomain],smtpUserName:[i.smtpUserName],smtpPassword:[i.smtpPassword]})}submit(){this.saving||this.form.invalid||(this.saving=!0,this.emailSettingsService.update(this.form.value).pipe(P(()=>this.saving=!1)).subscribe(()=>{this.toasterService.success("AbpSettingManagement::SavedSuccessfully"),this.getData()}))}openSendEmailModal(){this.buildEmailTestForm(),this.isEmailTestModalOpen=!0}buildEmailTestForm(){let{defaultFromAddress:i}=this.form.value||{},o=this.localizationService.instant("AbpSettingManagement::TestEmailSubject",Math.floor(Math.random()*9999).toString()),p=this.localizationService.instant("AbpSettingManagement::TestEmailBody");this.emailTestForm=this.fb.group({senderEmailAddress:[i||"",[w,Me]],targetEmailAddress:[this.currentUserEmail(),[w,Me]],subject:[o,[w]],body:[p]})}emailTestFormSubmit(){this.emailTestForm.invalid||this.emailSettingsService.sendTestEmail(this.emailTestForm.value).subscribe(i=>{this.toasterService.success("AbpSettingManagement::SentSuccessfully"),this.isEmailTestModalOpen=!1})}};e.\u0275fac=function(o){return new(o||e)(y(Ne),y(oe),y(Ee))},e.\u0275cmp=U({type:e,selectors:[["abp-email-setting-group"]],decls:8,vars:3,consts:[["abpHeader",""],["abpBody",""],["abpFooter",""],[1,"py-2","abp-md-form",3,"formGroup","validateOnSubmit"],[3,"visibleChange","visible","options"],[1,"py-2","abp-md-form",3,"ngSubmit","formGroup","validateOnSubmit"],[1,"mb-3","form-group"],[1,"form-label"],[1,"ms-1"],["type","text","formControlName","defaultFromDisplayName",1,"form-control"],["type","text","formControlName","defaultFromAddress",1,"form-control"],["type","text","formControlName","smtpHost",1,"form-control"],["type","number","formControlName","smtpPort",1,"form-control"],[1,"form-check","mb-2"],["type","checkbox","id","smtp-enable-ssl","formControlName","smtpEnableSsl",1,"form-check-input"],["for","smtp-enable-ssl",1,"form-check-label"],["type","checkbox","id","smtp-use-default-credentials","formControlName","smtpUseDefaultCredentials",1,"form-check-input"],["for","smtp-use-default-credentials",1,"form-check-label"],["type","text","formControlName","smtpDomain",1,"form-control"],["type","text","formControlName","smtpUserName",1,"form-control"],[1,"form-group"],["type","password","formControlName","smtpPassword",1,"form-control"],["buttonType","submit","iconClass","fa fa-save"],["type","button","class","btn btn-primary mx-2",3,"click",4,"abpPermission"],["type","button",1,"btn","btn-primary","mx-2",3,"click"],["aria-hidden","true",1,"fa","f-send"],["id","emailTestForm",3,"ngSubmit","formGroup"],["formControlName","senderEmailAddress",1,"form-control"],["formControlName","targetEmailAddress",1,"form-control"],["formControlName","subject",1,"form-control"],["formControlName","body",1,"form-control"],["buttonType","submit","iconClass","fa fa-send","formName","emailTestForm",3,"disabled"],["type","button","abpClose","",1,"btn","btn-secondary"]],template:function(o,p){if(o&1){let Ae=h();k(0,ze,58,38,"form",3),a(1,"abp-modal",4),W("visibleChange",function(C){return S(Ae),$(p.isEmailTestModalOpen,C)||(p.isEmailTestModalOpen=C),v(C)}),D(2,Be,3,3,"ng-template",null,0,I)(4,we,21,13,"ng-template",null,1,I)(6,Ve,7,7,"ng-template",null,2,I),n()}o&2&&(q(p.form?0:-1),r(),H("visible",p.isEmailTestModalOpen),g("options",p.modalSize))},dependencies:[re,te,X,ie,Q,Z,ee,ne,ae,J,be,ve,he,Te,le,me,se,ge],encapsulation:2,data:{animation:[Se]}});let t=e;return t})(),xe=(()=>{let e=class e extends ue{};e.\u0275fac=(()=>{let i;return function(p){return(i||(i=R(e)))(p||e)}})(),e.\u0275prov=M({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function Pe(){f(z).add([{name:"AbpSettingManagement::Settings",path:"/setting-management",parentName:"AbpUiNavigation::Menu:Administration",layout:"application",order:100,iconClass:"fa fa-cog"}])}var ye=new x("SETTING_MANAGEMENT_HAS_SETTING",{factory:()=>f(xe).visible$.pipe(L(0),F(e=>!!e.length))}),je=[E(()=>{Pe(),f(ye)})],Oe=[E(()=>{Re()})];function Re(){f(xe).add([{name:"AbpSettingManagement::Menu:Emailing",order:100,requiredPolicy:"SettingManagement.Emailing",component:Le}])}var Ue=new x("SETTING_MANAGEMENT_FEATURES",{providedIn:"root",factory:()=>{let t=f(B),e="SettingManagement.Enable";return ce(t,[e],i=>({enable:i[e].toLowerCase()!=="false"}))}}),_e=new x("SETTING_MANAGEMENT_ROUTE_VISIBILITY",{providedIn:"root",factory:()=>f(Ue).pipe(F(e=>e.enable))}),ke=[E(()=>{f(_e)})],qe=[E(()=>{He()})];function He(){let t=f(O),e=t.get(ye),c=t.get(_e),i=t.get(z);V([e,c]).subscribe(([o,p])=>{i.patch("AbpSettingManagement::Settings",{invisible:!(o&&p)})})}function dt(){return j([je,Oe,ke,qe])}export{xe as a,dt as b};
