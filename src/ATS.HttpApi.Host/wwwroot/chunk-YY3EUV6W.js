import{c as rt}from"./chunk-2RWPLSVX.js";import{a as $e,c as Qe,d as He,e as Xe,f as Je,g as Ze,h as et,i as tt,j as it,m as ue,n as nt,o as U,p as st,q as ot}from"./chunk-NKMSGKPA.js";import{X as pe,Y as Ye,_ as Ke,ba as ce,da as me,ea as de,fa as Et,i as Tt,j as It,k as Nt,l as xt,m as St,ma as wt,n as Pt,o as At,oa as We,p as Mt,q as Rt}from"./chunk-2KNHXYM4.js";import{A as yt,B as ve,C as Oe,Ja as re,Ka as Be,Ma as ae,N as Fe,Na as Le,P as vt,Q as Ge,Ra as je,Ta as qe,W as Ue,Ya as le,_a as ze,ba as Ve,c as ft,d as fe,f as P,ha as Ct,i as ge,j as we,m as ye,n as ke,p as gt,pa as se,q as De,va as oe}from"./chunk-BDOQTSQV.js";import{$ as _,Ab as k,Ba as Z,Bb as D,C as ct,Ca as _e,Cb as O,Ga as A,Ha as mt,Hb as Re,I as H,Ib as W,Jb as R,Kb as dt,Lb as ne,Mb as ut,N as he,Oa as Pe,Ob as g,P as F,Pb as y,Qa as E,Ra as w,Sa as q,Sb as S,T as G,U as be,Ua as z,V as j,Va as Y,W as X,Wa as d,Wb as ht,X as m,Xa as p,Ya as l,Za as N,Zc as Ee,_ as b,aa as J,bb as T,da as Se,gb as I,hb as c,j as $,lb as ee,mb as te,nb as ie,o as Q,pc as bt,r as pt,ra as a,rb as K,tb as Ae,vc as _t,wb as f,xb as x,yb as M,zb as Me}from"./chunk-KHY5JWQN.js";import{a as v,b as C}from"./chunk-R3EWYZZD.js";var kt=(()=>{let n=class n{constructor(i){this.restService=i,this.apiName="AbpIdentity",this.create=e=>this.restService.request({method:"POST",url:"/api/identity/roles",body:e},{apiName:this.apiName}),this.delete=e=>this.restService.request({method:"DELETE",url:`/api/identity/roles/${e}`},{apiName:this.apiName}),this.get=e=>this.restService.request({method:"GET",url:`/api/identity/roles/${e}`},{apiName:this.apiName}),this.getAllList=()=>this.restService.request({method:"GET",url:"/api/identity/roles/all"},{apiName:this.apiName}),this.getList=e=>this.restService.request({method:"GET",url:"/api/identity/roles",params:{filter:e.filter,sorting:e.sorting,skipCount:e.skipCount,maxResultCount:e.maxResultCount}},{apiName:this.apiName}),this.update=(e,s)=>this.restService.request({method:"PUT",url:`/api/identity/roles/${e}`,body:s},{apiName:this.apiName})}};n.\u0275fac=function(e){return new(e||n)(X(se))},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"});let t=n;return t})();var Dt=(()=>{let n=class n{constructor(i){this.restService=i,this.apiName="AbpIdentity",this.create=e=>this.restService.request({method:"POST",url:"/api/identity/users",body:e},{apiName:this.apiName}),this.delete=e=>this.restService.request({method:"DELETE",url:`/api/identity/users/${e}`},{apiName:this.apiName}),this.findByEmail=e=>this.restService.request({method:"GET",url:`/api/identity/users/by-email/${e}`},{apiName:this.apiName}),this.findByUsername=e=>this.restService.request({method:"GET",url:`/api/identity/users/by-username/${e}`},{apiName:this.apiName}),this.get=e=>this.restService.request({method:"GET",url:`/api/identity/users/${e}`},{apiName:this.apiName}),this.getAssignableRoles=()=>this.restService.request({method:"GET",url:"/api/identity/users/assignable-roles"},{apiName:this.apiName}),this.getList=e=>this.restService.request({method:"GET",url:"/api/identity/users",params:{filter:e.filter,sorting:e.sorting,skipCount:e.skipCount,maxResultCount:e.maxResultCount}},{apiName:this.apiName}),this.getRoles=e=>this.restService.request({method:"GET",url:`/api/identity/users/${e}/roles`},{apiName:this.apiName}),this.update=(e,s)=>this.restService.request({method:"PUT",url:`/api/identity/users/${e}`,body:s},{apiName:this.apiName}),this.updateRoles=(e,s)=>this.restService.request({method:"PUT",url:`/api/identity/users/${e}/roles`,body:s},{apiName:this.apiName})}};n.\u0275fac=function(e){return new(e||n)(X(se))},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"});let t=n;return t})();var Ot=(()=>{let n=class n{constructor(i){this.restService=i,this.apiName="AbpPermissionManagement",this.get=(e,s)=>this.restService.request({method:"GET",url:"/api/permission-management/permissions",params:{providerName:e,providerKey:s}},{apiName:this.apiName}),this.update=(e,s,r)=>this.restService.request({method:"PUT",url:"/api/permission-management/permissions",params:{providerName:e,providerKey:s},body:r},{apiName:this.apiName})}};n.\u0275fac=function(e){return new(e||n)(X(se))},n.\u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"});let t=n;return t})();var Zt=["selectAllInThisTabsRef"],ei=["selectAllInAllTabsRef"],ti=()=>({size:"lg",scrollable:!1}),ii=t=>({assignedCount:t});function ni(t,n){if(t&1&&(p(0,"h4"),f(1),g(2,"abpLocalization"),l()),t&2){let o=c(2);a(),Me(" ",y(2,2,"AbpPermissionManagement::Permissions")," - ",o.entityDisplayName||o.data.entityDisplayName," ")}}function si(t,n){if(t&1&&(p(0,"span"),f(1),l()),t&2){let o=c();a(),M("(",o.assignedCount,")")}}function oi(t,n){if(t&1){let o=T();p(0,"a",27),I("click",function(){b(o);let e=c().$implicit,s=c(3);return _(s.onChangeGroup(e))})("select",function(){b(o);let e=c().$implicit,s=c(3);return _(s.setDisabled(e.permissions))}),p(1,"div"),f(2),E(3,si,2,1,"span"),l()()}if(t&2){let o=n,i=c().$implicit,e=c(3);Ae("active",(e.selectedGroup==null?null:e.selectedGroup.name)===(i==null?null:i.name)),a(),Ae("font-weight-bold",o.assignedCount),a(),M(" ",i==null?null:i.displayName," "),a(),w(o.assignedCount>0?3:-1)}}function ri(t,n){if(t&1&&(p(0,"li",23),E(1,oi,4,6,"a",26),l()),t&2){let o,i=n.$implicit,e=c(3);a(),w((o=R(1,ii,e.getAssignedCount(i.name)))?1:-1,o)}}function ai(t,n){if(t&1&&(p(0,"span",34),f(1),l()),t&2){let o=n.$implicit;a(),Me("",o.providerName,": ",o.providerKey)}}function li(t,n){if(t&1&&z(0,ai,2,2,"span",34,q),t&2){let o=c().$implicit;Y(o.grantedProviders)}}function pi(t,n){if(t&1){let o=T();p(0,"div",31)(1,"input",32,5),I("click",function(){let e=b(o).$implicit,s=K(2),r=c(4);return _(r.onClickCheckbox(e,s.value))}),l(),p(3,"label",33),f(4),E(5,li,2,0),l()()}if(t&2){let o=n.$implicit,i=c(4);d("ngStyle",o.style),a(),d("checked",i.getChecked(o.name))("value",i.getChecked(o.name))("disabled",i.isGrantedByOtherProviderName(o.grantedProviders)),Pe("id",o.name),a(2),Pe("for",o.name),a(),M("",o.displayName," "),a(),w(i.hideBadges?-1:5)}}function ci(t,n){if(t&1){let o=T();p(0,"div",14)(1,"input",28,4),O("ngModelChange",function(e){b(o);let s=c(3);return D(s.selectThisTab,e)||(s.selectThisTab=e),_(e)}),I("click",function(){b(o);let e=c(3);return _(e.onClickSelectThisTab())}),l(),p(3,"label",29),f(4),g(5,"abpLocalization"),l()(),N(6,"hr",30),z(7,pi,6,8,"div",31,q)}if(t&2){let o=c(3);a(),k("ngModel",o.selectThisTab),d("disabled",o.disableSelectAllTab),a(3),x(y(5,3,"AbpPermissionManagement::SelectAllInThisTab")),a(3),Y(o.selectedGroupPermissions)}}function mi(t,n){if(t&1){let o=T();p(0,"div",7)(1,"div",8)(2,"div",9)(3,"span",10),N(4,"i",11),l(),p(5,"input",12),I("ngModelChange",function(e){b(o);let s=c(2);return _(s.filter.set(e))}),l()()(),p(6,"div",13)(7,"div",14)(8,"input",15,3),O("ngModelChange",function(e){b(o);let s=c(2);return D(s.selectAllTab,e)||(s.selectAllTab=e),_(e)}),I("click",function(){b(o);let e=c(2);return _(e.onClickSelectAll())}),l(),p(10,"label",16),f(11),g(12,"abpLocalization"),l()()()(),p(13,"fieldset",17)(14,"legend",18),f(15),g(16,"abpLocalization"),l(),p(17,"div",19)(18,"div",20)(19,"div",21)(20,"ul",22),z(21,ri,2,3,"li",23,q),l()()(),p(23,"div",24)(24,"div",25),E(25,ci,9,5),l()()()()}if(t&2){let o=c(2);a(5),d("ngModel",o.filter()),a(3),k("ngModel",o.selectAllTab),d("disabled",o.disabledSelectAllInAllTabs),a(3),x(y(12,6,"AbpPermissionManagement::SelectAllInAllTabs")),a(4),M(" ",y(16,8,"AbpPermissionManagement::PermissionGroup")," "),a(6),Y(o.permissionGroups()),a(4),w(o.selectedGroupPermissions.length?25:-1)}}function di(t,n){if(t&1){let o=T();p(0,"button",35),f(1),g(2,"abpLocalization"),l(),p(3,"abp-button",36),I("click",function(){b(o);let e=c(2);return _(e.submit())}),f(4),g(5,"abpLocalization"),l()}t&2&&(a(),M(" ",y(2,2,"AbpIdentity::Cancel")," "),a(3),x(y(5,4,"AbpIdentity::Save")))}function ui(t,n){t&1&&A(0,ni,3,4,"ng-template",null,0,S)(2,mi,26,10,"ng-template",null,1,S)(4,di,6,6,"ng-template",null,2,S)}var lt=(()=>{let n=class n{constructor(){this.service=m(Ot),this.configState=m(re),this.toasterService=m(ce),this.hideBadges=!1,this._visible=!1,this.visibleChange=new mt,this.data={groups:[],entityDisplayName:""},this.permissions=[],this.selectThisTab=!1,this.selectAllTab=!1,this.disableSelectAllTab=!1,this.disabledSelectAllInAllTabs=!1,this.modalBusy=!1,this.filter=Se(""),this.selectedGroupPermissions=[],this.permissionGroupSignal=Se([]),this.permissionGroups=ht(()=>{let i=this.filter().toLowerCase().trim(),e=this.permissionGroupSignal();if(!i)return this.setSelectedGroup(e[0]),e;let s=r=>r.toLowerCase().includes(i);return e=e.filter(r=>r.permissions.some(u=>s(u.displayName)||s(r.displayName))),e.length?this.setSelectedGroup(e[0]):this.selectedGroupPermissions=[],e}),this.trackByFn=(i,e)=>e.name}get visible(){return this._visible}set visible(i){i!==this._visible&&(i?this.openModal().subscribe(()=>{this._visible=!0,this.visibleChange.emit(!0),pt(this.selectAllInAllTabsRef.changes,this.selectAllInThisTabsRef.changes).pipe(ct(1)).subscribe(()=>{this.initModal()})}):(this.setSelectedGroup(null),this._visible=!1,this.visibleChange.emit(!1),this.filter.set("")))}getChecked(i){return(this.permissions.find(e=>e.name===i)||{isGranted:!1}).isGranted}setSelectedGroup(i){if(this.selectedGroup=i,!this.selectedGroup){this.selectedGroupPermissions=[];return}let e=`margin-${document.body.dir==="rtl"?"right":"left"}.px`,s=(this.data.groups.find(r=>r.name===this.selectedGroup?.name)||{}).permissions||[];this.selectedGroupPermissions=s.map(r=>C(v({},r),{style:{[e]:Ut(s,r)},isGranted:(this.permissions.find(u=>u.name===r.name)||{}).isGranted}))}setDisabled(i){i.length?this.disableSelectAllTab=i.every(e=>e.isGranted&&e.grantedProviders?.every(s=>s.providerName!==this.providerName)):this.disableSelectAllTab=!1}isGrantedByOtherProviderName(i){return i.length?i.findIndex(e=>e.providerName!==this.providerName)>-1:!1}onClickCheckbox(i){let{isGranted:e,grantedProviders:s}=i;e&&this.isGrantedByOtherProviderName(s)||(this.setSelectedGroup(this.selectedGroup),setTimeout(()=>{this.updatePermissionStatus(i),this.updateSelectedGroupPermissions(i),this.setParentClicked(i),this.setTabCheckboxState(),this.setGrantCheckboxState()},0))}updatePermissionStatus(i){this.permissions=this.permissions.map(e=>{let s=i.name==e.name,r=i.parentName===e.name,u=i.name===e.parentName;return s?C(v({},e),{isGranted:!e.isGranted}):u&&e.isGranted?C(v({},e),{isGranted:!1}):r&&!e.isGranted?C(v({},e),{isGranted:!0}):e})}setParentClicked(i){if(i.parentName){let e=Ft(this.permissions,i);if(e.length>0){let s=new Set(e.map(r=>r.name));this.permissions=this.permissions.map(r=>{let u=r.isGranted;return r.parentName===i.name&&!i.isGranted&&(u=!1),s.has(r.name)&&(u=!0),C(v({},r),{isGranted:u})})}return}this.permissions=this.permissions.map(e=>{let s=Ft(this.permissions,e);if(s.length>0){let r=s[s.length-1];if(r.name===i.name&&!r.isGranted)return C(v({},e),{isGranted:!1})}return e})}updateSelectedGroupPermissions(i){this.selectedGroupPermissions=this.selectedGroupPermissions.map(e=>(e.name===i.name&&(e.isGranted=!e.isGranted),e))}setTabCheckboxState(){let i=this.selectedGroupPermissions.filter(r=>r.grantedProviders.every(u=>u.providerName===this.providerName)),e=i.filter(r=>r.isGranted),s=document.querySelector("#select-all-in-this-tabs");s&&(e.length===i.length?(s.indeterminate=!1,this.selectThisTab=!0):e.length===0?(s.indeterminate=!1,this.selectThisTab=!1):s.indeterminate=!0)}setGrantCheckboxState(){let i=this.permissions.filter(r=>r.grantedProviders.every(u=>u.providerName===this.providerName)),e=i.filter(r=>r.isGranted),s=document.querySelector("#select-all-in-all-tabs");e.length===i.length?(s.indeterminate=!1,this.selectAllTab=!0):e.length===0?(s.indeterminate=!1,this.selectAllTab=!1):s.indeterminate=!0}onClickSelectThisTab(){this.selectedGroupPermissions.forEach(i=>{if(i.isGranted&&this.isGrantedByOtherProviderName(i.grantedProviders))return;let e=this.permissions.findIndex(s=>s.name===i.name);this.permissions=[...this.permissions.slice(0,e),C(v({},this.permissions[e]),{isGranted:!this.selectThisTab}),...this.permissions.slice(e+1)]}),this.setGrantCheckboxState()}onClickSelectAll(){this.filter()&&this.filter.set(""),this.permissions=this.permissions.map(i=>C(v({},i),{isGranted:this.isGrantedByOtherProviderName(i.grantedProviders)||!this.selectAllTab})),this.disableSelectAllTab||(this.selectThisTab=!this.selectAllTab,this.setTabCheckboxState(),this.filter()&&this.setGrantCheckboxState()),this.onChangeGroup(this.selectedGroup)}onChangeGroup(i){this.setDisabled(i.permissions),this.setSelectedGroup(i),this.setTabCheckboxState()}submit(){let i=Gt(this.data.groups),e=this.permissions.filter(s=>(i.find(r=>r.name===s.name)||{}).isGranted!==s.isGranted).map(({name:s,isGranted:r})=>({name:s,isGranted:r}));if(!e.length){this.visible=!1;return}this.modalBusy=!0,this.service.update(this.providerName,this.providerKey,{permissions:e}).pipe(he(()=>this.shouldFetchAppConfig()?this.configState.refreshAppState():$(null)),H(()=>this.modalBusy=!1)).subscribe(()=>{this.visible=!1,this.toasterService.success("AbpUi::SavedSuccessfully")})}openModal(){if(!this.providerKey||!this.providerName)throw new Error("Provider Key and Provider Name are required.");return this.service.get(this.providerName,this.providerKey).pipe(F(i=>{let{groups:e}=i||{};this.data=i,this.permissionGroupSignal.set(e),this.permissions=Gt(e),this.setSelectedGroup(e[0]),this.disabledSelectAllInAllTabs=this.permissions.every(s=>s.isGranted&&s.grantedProviders.every(r=>r.providerName!==this.providerName))}))}initModal(){setTimeout(()=>{this.setDisabled(this.selectedGroup?.permissions||[]),this.setTabCheckboxState(),this.setGrantCheckboxState()})}getAssignedCount(i){return this.permissions.reduce((e,s)=>s.groupName===i&&s.isGranted?e+1:e,0)}shouldFetchAppConfig(){let i=this.configState.getOne("currentUser");return this.providerName==="R"?i.roles.some(e=>e===this.providerKey):this.providerName==="U"?i.id===this.providerKey:!1}};n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Z({type:n,selectors:[["abp-permission-management"]],viewQuery:function(e,s){if(e&1&&(ee(Zt,5),ee(ei,5)),e&2){let r;te(r=ie())&&(s.selectAllInThisTabsRef=r),te(r=ie())&&(s.selectAllInAllTabsRef=r)}},inputs:{providerName:"providerName",providerKey:"providerKey",hideBadges:"hideBadges",entityDisplayName:"entityDisplayName",visible:"visible"},outputs:{visibleChange:"visibleChange"},exportAs:["abpPermissionManagement"],decls:2,vars:5,consts:[["abpHeader",""],["abpBody",""],["abpFooter",""],["selectAllInAllTabsRef",""],["selectAllInThisTabsRef",""],["permissionCheckbox",""],[3,"visibleChange","visible","busy","options"],[1,"row","d-flex","align-items-center","mb-2"],[1,"col"],[1,"input-group","mb-2"],["id","basic-addon1",1,"input-group-text"],[1,"bi","bi-search"],["type","text","id","permission-search","placeholder","Filter",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-auto"],[1,"form-check","mb-2"],["type","checkbox","id","select-all-in-all-tabs","name","select-all-in-all-tabs",1,"form-check-input",3,"ngModelChange","click","ngModel","disabled"],["for","select-all-in-all-tabs",1,"form-check-label"],[1,"border","rounded-4","p-3"],[1,"px-1","h5","mb-0"],[1,"row"],[1,"col-md-4"],[1,"overflow-auto","lpx-scroll-pills-container","scroll-in-modal"],[1,"nav","nav-pills","flex-column"],[1,"border","nav-item"],[1,"col-md-8","scroll-in-modal"],[1,"ps-1"],[1,"nav-link","pointer",3,"active"],[1,"nav-link","pointer",3,"click","select"],["type","checkbox","id","select-all-in-this-tabs","name","select-all-in-this-tabs",1,"form-check-input",3,"ngModelChange","click","ngModel","disabled"],["for","select-all-in-this-tabs",1,"form-check-label"],[1,"my-2"],[1,"form-check","mb-2",3,"ngStyle"],["type","checkbox",1,"form-check-input",3,"click","checked","value","disabled"],[1,"form-check-label"],[1,"badge","bg-primary","text-dark"],["type","button","abpClose","",1,"btn","btn-outline-primary"],["iconClass","fa fa-check",3,"click"]],template:function(e,s){e&1&&(p(0,"abp-modal",6),O("visibleChange",function(u){return D(s.visible,u)||(s.visible=u),u}),E(1,ui,6,0),l()),e&2&&(k("visible",s.visible),d("busy",s.modalBusy)("options",W(4,ti)),a(),w(s.data.entityDisplayName||s.entityDisplayName?1:-1))},dependencies:[ve,fe,ft,ge,ye,_t,bt,me,le,pe,de],styles:[".scroll-in-modal[_ngcontent-%COMP%]{overflow:auto;max-height:calc(100vh - 23.1rem)}.lpx-scroll-pills-container[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{display:block;overflow-y:auto}@media (max-width: 768px){.scroll-in-modal[_ngcontent-%COMP%]{max-height:calc(100vh - 15rem)}.lpx-scroll-pills-container[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{max-height:500px}}fieldset[_ngcontent-%COMP%]   legend[_ngcontent-%COMP%]{float:none;width:auto}.lpx-scroll-pills-container[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]{padding-top:0!important;padding-bottom:0!important}.lpx-scroll-pills-container[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:10px;border-radius:10px}.lpx-scroll-pills-container[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{color:#fff!important;border-color:#6c5dd3!important;background-color:#6c5dd3!important}"]});let t=n;return t})();function Ft(t,n){let o=new Map(t.map(s=>[s.name,s])),i=o.get(n.name)??null,e=[];for(;i&&i.parentName;){let s=o.get(i.parentName);if(!s)break;e.push(s),i=s}return e}function Ut(t,n){let o=t.find(i=>i.name===n.parentName);if(o&&o.parentName){let i=20;return i+=Ut(t,o)}return o?20:0}function Gt(t){return t.reduce((n,o)=>[...n,...o.permissions.map(i=>C(v({},i),{groupName:o.name||""}))],[])}var hi=()=>({value:"R"}),Vt=t=>({value:t}),Bt=t=>({value:t,twoWay:!0}),bi=()=>({value:!0}),_i=(t,n,o,i)=>({providerName:t,providerKey:n,visible:o,hideBadges:i}),Lt=t=>({visibleChange:t}),jt=(t,n,o)=>({inputs:t,outputs:n,componentKey:o});function fi(t,n){if(t&1&&(p(0,"h3"),f(1),g(2,"abpLocalization"),l()),t&2){let o=c();a(),x(y(2,1,o.selected!=null&&o.selected.id?"AbpIdentity::Edit":"AbpIdentity::NewRole"))}}function gi(t,n){if(t&1){let o=T();p(0,"form",10),I("ngSubmit",function(){b(o);let e=c();return _(e.save())}),N(1,"abp-extensible-form",11),l()}if(t&2){let o=c();d("formGroup",o.form)("validateOnSubmit",!0),a(),d("selectedRecord",o.selected)}}function yi(t,n){if(t&1){let o=T();p(0,"button",12),f(1),g(2,"abpLocalization"),l(),p(3,"abp-button",13),I("click",function(){b(o);let e=c();return _(e.save())}),f(4),g(5,"abpLocalization"),l()}if(t&2){let o=c();a(),M(" ",y(2,3,"AbpIdentity::Cancel")," "),a(2),d("disabled",o.form==null?null:o.form.invalid),a(),x(y(5,5,"AbpIdentity::Save"))}}function vi(t,n){if(t&1){let o=T();p(0,"abp-permission-management",14,3),I("abpInit",function(){let e=b(o).initTemplate,s=K(1);return _(e(s))}),l()}}var Ci=["modalContent"],Ti=()=>({value:"U"}),Ii=(t,n,o)=>({providerName:t,providerKey:n,visible:o}),Ni=(t,n,o)=>({checkboxId:t,label:n,formControl:o}),xi=(t,n)=>({inputs:t,componentKey:n});function Si(t,n){if(t&1&&(p(0,"h3"),f(1),g(2,"abpLocalization"),l()),t&2){let o=c();a(),x(y(2,1,o.selected!=null&&o.selected.id?"AbpIdentity::Edit":"AbpIdentity::NewUser"))}}function Pi(t,n){if(t&1&&N(0,"abp-extensible-form",22),t&2){let o=c(3);d("selectedRecord",o.selected)}}function Ai(t,n){if(t&1&&N(0,"abp-checkbox",25),t&2){let o=c(),i=o.$implicit,e=o.$index,s=c(4);d("checkboxId","roles-"+e)("formControl",i.controls[s.roles[e].name])("label",s.roles[e].name)}}function Mi(t,n){if(t&1&&(p(0,"div",23),A(1,Ai,1,3,"abp-checkbox",24),l()),t&2){let o=n.$implicit,i=n.$index,e=c(4);a(),d("abpReplaceableTemplate",dt(5,xi,ne(1,Ni,"roles-"+i,e.roles[i].name,o.controls[e.roles[i].name]),e.inputKey))}}function Ri(t,n){if(t&1&&z(0,Mi,2,8,"div",23,q),t&2){let o=c(3);Y(o.roleGroups)}}function Ei(t,n){if(t&1){let o=T();p(0,"form",16),I("ngSubmit",function(){b(o);let e=c(2);return _(e.save())}),p(1,"ul",17,3)(3,"li",18)(4,"a",19),f(5),g(6,"abpLocalization"),l(),A(7,Pi,1,1,"ng-template",20),l(),p(8,"li",18)(9,"a",19),f(10),g(11,"abpLocalization"),l(),A(12,Ri,2,0,"ng-template",20),l()(),N(13,"div",21),l()}if(t&2){let o=K(2),i=c(2);d("formGroup",i.form),a(5),x(y(6,4,"AbpIdentity::UserInformations")),a(5),x(y(11,6,"AbpIdentity::Roles")),a(3),d("ngbNavOutlet",o)}}function wi(t,n){t&1&&(p(0,"div",15),N(1,"i",26),l())}function ki(t,n){if(t&1&&E(0,Ei,14,8,"form",14)(1,wi,2,0,"div",15),t&2){let o=c();w(o.form?0:1)}}function Di(t,n){if(t&1){let o=T();p(0,"button",27),f(1),g(2,"abpLocalization"),l(),p(3,"abp-button",28),I("click",function(){b(o);let e=c();return _(e.save())}),f(4),g(5,"abpLocalization"),l()}if(t&2){let o=c();a(),M(" ",y(2,3,"AbpIdentity::Cancel")," "),a(2),d("disabled",o.form==null?null:o.form.invalid),a(),x(y(5,5,"AbpIdentity::Save"))}}function Oi(t,n){if(t&1){let o=T();p(0,"abp-permission-management",29,4),I("abpInit",function(){let e=b(o).initTemplate,s=K(1);return _(e(s))}),l()}if(t&2){let o=c();d("entityDisplayName",o.entityDisplayName)}}var V=(()=>{let n=class n{constructor(){this.list=m(oe),this.confirmationService=m(Ke),this.toasterService=m(ce),this.injector=m(J),this.service=m(kt),this.data={items:[],totalCount:0},this.visiblePermissions=!1,this.modalBusy=!1,this.permissionManagementKey="PermissionManagement.PermissionManagementComponent",this.onVisiblePermissionChange=i=>{this.visiblePermissions=i}}ngOnInit(){this.hookToQuery()}buildForm(){let i=new He(this.injector,this.selected);this.form=nt(i)}openModal(){this.buildForm(),this.isModalVisible=!0}add(){this.selected={},this.openModal()}edit(i){this.service.get(i).subscribe(e=>{this.selected=e,this.openModal()})}save(){if(!this.form.valid)return;this.modalBusy=!0;let{id:i}=this.selected||{};(i?this.service.update(i,v(v({},this.selected),this.form.value)):this.service.create(this.form.value)).pipe(H(()=>this.modalBusy=!1)).subscribe(()=>{this.isModalVisible=!1,this.toasterService.success("AbpUi::SavedSuccessfully"),this.list.get()})}delete(i,e){this.confirmationService.warn("AbpIdentity::RoleDeletionConfirmationMessage","AbpIdentity::AreYouSure",{messageLocalizationParams:[e]}).subscribe(s=>{s===Ye.Status.confirm&&(this.toasterService.success("AbpUi::DeletedSuccessfully"),this.service.delete(i).subscribe(()=>this.list.get()))})}hookToQuery(){this.list.hookToQuery(i=>this.service.getList(i)).subscribe(i=>this.data=i)}openPermissionsModal(i){this.providerKey=i,setTimeout(()=>{this.visiblePermissions=!0},0)}sort(i){let{prop:e,dir:s}=i.sorts[0];this.list.sortKey=e,this.list.sortOrder=s}};n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Z({type:n,selectors:[["abp-roles"]],features:[Re([oe,{provide:$e,useValue:"Identity.RolesComponent"}])],decls:13,vars:27,consts:[["abpHeader",""],["abpBody",""],["abpFooter",""],["abpPermissionManagement","abpPermissionManagement"],[3,"title","toolbar"],["id","identity-roles-wrapper",1,"card"],[1,"card-body"],[3,"data","recordsTotal","list"],[3,"visibleChange","visible","busy"],[3,"abpInit",4,"abpReplaceableTemplate"],[3,"ngSubmit","formGroup","validateOnSubmit"],[3,"selectedRecord"],["type","button","abpClose","",1,"btn","btn-outline-primary"],["iconClass","fa fa-check",3,"click","disabled"],[3,"abpInit"]],template:function(e,s){if(e&1){let r=T();p(0,"abp-page",4),g(1,"abpLocalization"),p(2,"div",5)(3,"div",6),N(4,"abp-extensible-table",7),l()(),p(5,"abp-modal",8),O("visibleChange",function(h){return b(r),D(s.isModalVisible,h)||(s.isModalVisible=h),_(h)}),A(6,fi,3,3,"ng-template",null,0,S)(8,gi,2,3,"ng-template",null,1,S)(10,yi,6,7,"ng-template",null,2,S),l(),A(12,vi,2,0,"abp-permission-management",9),l()}e&2&&(d("title",y(1,8,"AbpIdentity::Roles"))("toolbar",s.data.items),a(4),d("data",s.data.items)("recordsTotal",s.data.totalCount)("list",s.list),a(),k("visible",s.isModalVisible),d("busy",s.modalBusy),a(7),d("abpReplaceableTemplate",ne(23,jt,ut(16,_i,W(10,hi),R(11,Vt,s.providerKey),R(13,Bt,s.visiblePermissions),W(15,bi)),R(21,Lt,s.onVisiblePermissionChange),s.permissionManagementKey)))},dependencies:[Oe,ke,we,De,le,it,me,pe,rt,tt,de,lt,qe,Ge,Fe,je],encapsulation:2});let t=n;return t})(),B=(()=>{let n=class n{constructor(){this.list=m(oe),this.confirmationService=m(Ke),this.service=m(Dt),this.toasterService=m(ce),this.fb=m(yt),this.injector=m(J),this.data={items:[],totalCount:0},this.visiblePermissions=!1,this.modalBusy=!1,this.permissionManagementKey="PermissionManagement.PermissionManagementComponent",this.inputKey=wt.FormCheckboxComponent,this.trackByFn=(i,e)=>Object.keys(e)[0]||i,this.onVisiblePermissionChange=i=>{this.visiblePermissions=i}}get roleGroups(){return this.form.get("roleNames")?.controls||[]}ngOnInit(){this.hookToQuery()}buildForm(){let i=new He(this.injector,this.selected);this.form=nt(i),this.service.getAssignableRoles().subscribe(({items:e})=>{this.roles=e,this.roles&&this.form.addControl("roleNames",this.fb.array(this.roles.map(s=>this.fb.group({[s.name]:[this.selected?.id?!!this.selectedUserRoles?.find(r=>r.id===s.id):s.isDefault]}))))})}openModal(){this.buildForm(),this.isModalVisible=!0}add(){this.selected={},this.selectedUserRoles=[],this.openModal()}edit(i){this.service.get(i).pipe(F(e=>this.selected=e),he(()=>this.service.getRoles(i))).subscribe(e=>{this.selectedUserRoles=e.items||[],this.openModal()})}save(){if(!this.form.valid||this.modalBusy)return;this.modalBusy=!0;let{roleNames:i=[]}=this.form.value,e=i.filter(r=>!!r[Object.keys(r)[0]]).map(r=>Object.keys(r)[0])||[],{id:s}=this.selected||{};(s?this.service.update(s,C(v(v({},this.selected),this.form.value),{roleNames:e})):this.service.create(C(v({},this.form.value),{roleNames:e}))).pipe(H(()=>this.modalBusy=!1)).subscribe(()=>{this.isModalVisible=!1,this.toasterService.success("AbpUi::SavedSuccessfully"),this.list.get()})}delete(i,e){this.confirmationService.warn("AbpIdentity::UserDeletionConfirmationMessage","AbpIdentity::AreYouSure",{messageLocalizationParams:[e]}).subscribe(s=>{s===Ye.Status.confirm&&this.service.delete(i).subscribe(()=>{this.toasterService.success("AbpUi::DeletedSuccessfully"),this.list.get()})})}sort(i){let{prop:e,dir:s}=i.sorts[0];this.list.sortKey=e,this.list.sortOrder=s}hookToQuery(){this.list.hookToQuery(i=>this.service.getList(i)).subscribe(i=>this.data=i)}openPermissionsModal(i,e){this.providerKey=i,this.entityDisplayName=e,setTimeout(()=>{this.visiblePermissions=!0},0)}};n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=Z({type:n,selectors:[["abp-users"]],viewQuery:function(e,s){if(e&1&&ee(Ci,5),e&2){let r;te(r=ie())&&(s.modalContent=r.first)}},features:[Re([oe,{provide:$e,useValue:"Identity.UsersComponent"}])],decls:17,vars:29,consts:[["abpHeader",""],["abpBody",""],["abpFooter",""],["nav","ngbNav"],["abpPermissionManagement","abpPermissionManagement"],[3,"title","toolbar"],["id","identity-roles-wrapper",1,"card"],[1,"card-body"],["id","data-tables-table-filter",1,"data-tables-filter","mb-3"],[1,"input-group"],["type","search",1,"form-control",3,"ngModelChange","placeholder","ngModel"],[3,"data","recordsTotal","list"],[3,"visibleChange","visible","busy"],[3,"entityDisplayName","abpInit",4,"abpReplaceableTemplate"],[3,"formGroup"],[1,"text-center"],[3,"ngSubmit","formGroup"],["ngbNav","",1,"nav-tabs"],["ngbNavItem",""],["ngbNavLink",""],["ngbNavContent",""],[1,"mt-2","fade-in-top",3,"ngbNavOutlet"],[3,"selectedRecord"],[1,"form-check","mb-2"],[3,"checkboxId","formControl","label",4,"abpReplaceableTemplate"],[3,"checkboxId","formControl","label"],["aria-hidden","true",1,"fa","fa-pulse","fa-spinner"],["type","button","abpClose","",1,"btn","btn-outline-primary"],["iconClass","fa fa-check",3,"click","disabled"],[3,"abpInit","entityDisplayName"]],template:function(e,s){if(e&1){let r=T();p(0,"abp-page",5),g(1,"abpLocalization"),p(2,"div",6)(3,"div",7)(4,"div",8)(5,"div",9)(6,"input",10),g(7,"abpLocalization"),O("ngModelChange",function(h){return b(r),D(s.list.filter,h)||(s.list.filter=h),_(h)}),l()()(),N(8,"abp-extensible-table",11),l()(),p(9,"abp-modal",12),O("visibleChange",function(h){return b(r),D(s.isModalVisible,h)||(s.isModalVisible=h),_(h)}),A(10,Si,3,3,"ng-template",null,0,S)(12,ki,2,1,"ng-template",null,1,S)(14,Di,6,7,"ng-template",null,2,S),l(),A(16,Oi,2,1,"abp-permission-management",13),l()}e&2&&(d("title",y(1,10,"AbpIdentity::Users"))("toolbar",s.data.items),a(6),d("placeholder",y(7,12,"AbpUi::PagerSearch")),k("ngModel",s.list.filter),a(2),d("data",s.data.items)("recordsTotal",s.data.totalCount)("list",s.list),a(),k("visible",s.isModalVisible),d("busy",s.modalBusy),a(7),d("abpReplaceableTemplate",ne(25,jt,ne(19,Ii,W(14,Ti),R(15,Vt,s.providerKey),R(17,Bt,s.visiblePermissions)),R(23,Lt,s.onVisiblePermissionChange),s.permissionManagementKey)))},dependencies:[Oe,ke,fe,ge,we,gt,De,ve,ye,lt,rt,Rt,It,St,xt,Nt,At,Pt,Mt,Tt,Ge,Fe,vt,le,it,me,tt,Et,pe,qe,de,je],encapsulation:2});let t=n;return t})(),Fi=Xe.createMany([{text:"AbpIdentity::Edit",action:t=>{t.getInjected(V).edit(t.record.id||"")},permission:"AbpIdentity.Roles.Update"},{text:"AbpIdentity::Permissions",action:t=>{t.getInjected(V).openPermissionsModal(t.record.name||"")},permission:"AbpIdentity.Roles.ManagePermissions"},{text:"AbpIdentity::Delete",action:t=>{t.getInjected(V).delete(t.record.id||"",t.record.name||"")},permission:"AbpIdentity.Roles.Delete",visible:t=>!t?.record.isStatic}]),Gi=Je.createMany([{type:"string",name:"name",displayName:"AbpIdentity::RoleName",sortable:!0,valueResolver:t=>{let n=t.getInjected(Be),o=n.instant.bind(n),{isDefault:i,isPublic:e,name:s}=t.record;return $(Ve(s)+(i?`<span class="badge rounded-pill bg-success ms-1">${o("AbpIdentity::DisplayName:IsDefault")}</span>`:"")+(e?`<span class="badge rounded-pill bg-info ms-1">${o("AbpIdentity::DisplayName:IsPublic")}</span>`:""))}}]),qt=Qe.createMany([{type:"string",name:"name",displayName:"AbpIdentity::RoleName",id:"role-name",disabled:t=>t.record&&t.record.isStatic,validators:()=>[P.required]},{type:"boolean",name:"isDefault",displayName:"AbpIdentity::DisplayName:IsDefault",id:"role-is-default",defaultValue:!1},{type:"boolean",name:"isPublic",displayName:"AbpIdentity::DisplayName:IsPublic",id:"role-is-public",defaultValue:!1}]),Ui=qt,Vi=Ze.createMany([{text:"AbpIdentity::NewRole",action:t=>{t.getInjected(V).add()},permission:"AbpIdentity.Roles.Create",icon:"fa fa-plus"}]),Bi=Xe.createMany([{text:"AbpIdentity::Edit",action:t=>{t.getInjected(B).edit(t.record.id||"")},permission:"AbpIdentity.Users.Update"},{text:"AbpIdentity::Permissions",action:t=>{t.getInjected(B).openPermissionsModal(t.record.id||"",t.record.userName)},permission:"AbpIdentity.Users.ManagePermissions"},{text:"AbpIdentity::Delete",action:t=>{t.getInjected(B).delete(t.record.id||"",t.record.name||t.record.userName||"")},visible:t=>{let n=t?.record.userName,i=t?.getInjected(re)?.getOne("currentUser");return n!==i.userName},permission:"AbpIdentity.Users.Delete"}]),Li=Je.createMany([{type:"string",name:"userName",displayName:"AbpIdentity::UserName",sortable:!0,columnWidth:250,valueResolver:t=>{let n=t.getInjected(Be),i=`<i title="${n.instant.bind(n)("AbpIdentity::ThisUserIsNotActiveMessage")}" class="fas fa-ban text-danger me-1" aria-hidden="true"></i>`;return $(`
        ${t.record.isActive?"":i}
        <span class="${t.record.isActive?"":"text-muted"}">${Ve(t.record.userName)}</span>`)}},{type:"string",name:"email",displayName:"AbpIdentity::EmailAddress",sortable:!0,columnWidth:250},{type:"string",name:"phoneNumber",displayName:"AbpIdentity::PhoneNumber",sortable:!0,columnWidth:250}]),zt=Qe.createMany([{type:"string",name:"userName",displayName:"AbpIdentity::UserName",id:"user-name",validators:()=>[P.required,P.maxLength(256)]},{type:"passwordinputgroup",name:"password",displayName:"AbpIdentity::Password",id:"password",autocomplete:"new-password",validators:t=>[P.required,...We({get:t.getInjected})]},{type:"string",name:"name",displayName:"AbpIdentity::DisplayName:Name",id:"name",validators:()=>[P.maxLength(64)]},{type:"string",name:"surname",displayName:"AbpIdentity::DisplayName:Surname",id:"surname",validators:()=>[P.maxLength(64)]},{type:"email",name:"email",displayName:"AbpIdentity::EmailAddress",id:"email",validators:()=>[P.required,P.maxLength(256),P.email]},{type:"string",name:"phoneNumber",displayName:"AbpIdentity::PhoneNumber",id:"phone-number",validators:()=>[P.maxLength(16)]},{type:"boolean",name:"isActive",displayName:"AbpIdentity::DisplayName:IsActive",id:"active-checkbox",defaultValue:!0},{type:"boolean",name:"lockoutEnabled",displayName:"AbpIdentity::DisplayName:LockoutEnabled",id:"lockout-checkbox",defaultValue:!0}]),ji=zt.map(t=>t.name==="password"?C(v({},t),{validators:n=>[...We({get:n.getInjected})]}):t.name==="isActive"?C(v({},t),{visible:n=>n.getInjected(re).getDeep("currentUser.id")!==n.record.id}):t),qi=Ze.createMany([{text:"AbpIdentity::NewUser",action:t=>{t.getInjected(B).add()},permission:"AbpIdentity.Users.Create",icon:"fa fa-plus"}]),Yt={"Identity.RolesComponent":Fi,"Identity.UsersComponent":Bi},Kt={"Identity.RolesComponent":Vi,"Identity.UsersComponent":qi},Wt={"Identity.RolesComponent":Gi,"Identity.UsersComponent":Li},$t={"Identity.RolesComponent":qt,"Identity.UsersComponent":zt},Qt={"Identity.RolesComponent":Ui,"Identity.UsersComponent":ji},Ce=new j("IDENTITY_ENTITY_ACTION_CONTRIBUTORS"),Te=new j("IDENTITY_TOOLBAR_ACTION_CONTRIBUTORS"),Ie=new j("IDENTITY_ENTITY_PROP_CONTRIBUTORS"),Ne=new j("IDENTITY_CREATE_FORM_PROP_CONTRIBUTORS"),xe=new j("IDENTITY_EDIT_FORM_PROP_CONTRIBUTORS"),zi=(()=>{let n=class n{constructor(){this.injector=m(J),this.extensions=m(et)}canActivate(){let i={optional:!0},e=m(Ce,i)||{},s=m(Te,i)||{},r=m(Ie,i)||{},u=m(Ne,i)||{},h=m(xe,i)||{};return st(this.injector,"Identity").pipe(Q(L=>({"Identity.RolesComponent":L.Role,"Identity.UsersComponent":L.User})),ot(this.injector,"AbpIdentity"),F(L=>{ue(this.extensions.entityActions,Yt,e),ue(this.extensions.toolbarActions,Kt,s),U(this.extensions.entityProps,Wt,L.prop,r),U(this.extensions.createFormProps,$t,L.createForm,u),U(this.extensions.editFormProps,Qt,L.editForm,h)}),Q(()=>!0))}};n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=G({token:n,factory:n.\u0275fac});let t=n;return t})(),Ht=()=>{let t=m(et),n={optional:!0},o=m(Ce,n)||{},i=m(Te,n)||{},e=m(Ie,n)||{},s=m(Ne,n)||{},r=m(xe,n)||{},u=m(J);return st(u,"Identity").pipe(Q(h=>({"Identity.RolesComponent":h.Role,"Identity.UsersComponent":h.User})),ot(u,"AbpIdentity"),F(h=>{ue(t.entityActions,Yt,o),ue(t.toolbarActions,Kt,i),U(t.entityProps,Wt,h.prop,e),U(t.createFormProps,$t,h.createForm,s),U(t.editFormProps,Qt,h.editForm,r)}))},Yi=[{path:"",redirectTo:"roles",pathMatch:"full"},{path:"",component:Le,canActivate:[Ue,ze],resolve:[Ht],children:[{path:"roles",component:ae,data:{requiredPolicy:"AbpIdentity.Roles",replaceableComponent:{key:"Identity.RolesComponent",defaultComponent:V}},title:"AbpIdentity::Roles"},{path:"users",component:ae,data:{requiredPolicy:"AbpIdentity.Users",replaceableComponent:{key:"Identity.UsersComponent",defaultComponent:B}},title:"AbpIdentity::Users"}]}],Ki=(()=>{let n=class n{};n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=_e({type:n}),n.\u0275inj=be({imports:[Ee.forChild(Yi),Ee]});let t=n;return t})(),wn=(()=>{let n=class n{static forChild(i={}){return{ngModule:n,providers:[{provide:Ce,useValue:i.entityActionContributors},{provide:Te,useValue:i.toolbarActionContributors},{provide:Ie,useValue:i.entityPropContributors},{provide:Ne,useValue:i.createFormPropContributors},{provide:xe,useValue:i.editFormPropContributors},zi]}}static forLazy(i={}){return new Ct(n.forChild(i))}};n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=_e({type:n}),n.\u0275inj=be({imports:[Ki,V,B]});let t=n;return t})();function Wi(t={}){return[{provide:Ce,useValue:t.entityActionContributors},{provide:Te,useValue:t.toolbarActionContributors},{provide:Ie,useValue:t.entityPropContributors},{provide:Ne,useValue:t.createFormPropContributors},{provide:xe,useValue:t.editFormPropContributors}]}var kn=(t={})=>[{path:"",component:Le,canActivate:[Ue,ze],resolve:[Ht],providers:Wi(t),children:[{path:"",redirectTo:"roles",pathMatch:"full"},{path:"roles",component:ae,data:{requiredPolicy:"AbpIdentity.Roles",replaceableComponent:{key:"Identity.RolesComponent",defaultComponent:V}},title:"AbpIdentity::Roles"},{path:"users",component:ae,data:{requiredPolicy:"AbpIdentity.Users",replaceableComponent:{key:"Identity.UsersComponent",defaultComponent:B}},title:"AbpIdentity::Users"}]}];export{$t as DEFAULT_IDENTITY_CREATE_FORM_PROPS,Qt as DEFAULT_IDENTITY_EDIT_FORM_PROPS,Yt as DEFAULT_IDENTITY_ENTITY_ACTIONS,Wt as DEFAULT_IDENTITY_ENTITY_PROPS,Kt as DEFAULT_IDENTITY_TOOLBAR_ACTIONS,Ne as IDENTITY_CREATE_FORM_PROP_CONTRIBUTORS,xe as IDENTITY_EDIT_FORM_PROP_CONTRIBUTORS,Ce as IDENTITY_ENTITY_ACTION_CONTRIBUTORS,Ie as IDENTITY_ENTITY_PROP_CONTRIBUTORS,Te as IDENTITY_TOOLBAR_ACTION_CONTRIBUTORS,zi as IdentityExtensionsGuard,wn as IdentityModule,V as RolesComponent,B as UsersComponent,kn as createRoutes,Ht as identityExtensionsResolver,Wi as provideIdentity};
