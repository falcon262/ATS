<div class="container-fluid py-4">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a routerLink="/dashboard">Dashboard</a></li>
          <li class="breadcrumb-item active">Pipeline Board</li>
        </ol>
      </nav>
      <h1 class="h2 mb-2">Pipeline Board</h1>
      <p class="text-muted mb-0">Drag and drop applications to move them between stages</p>
    </div>
    <div class="col-auto">
      <div class="mb-3">
        <label class="form-label me-2">Filter by Job:</label>
        <select class="form-select d-inline-block" style="width: auto;" [(ngModel)]="selectedJobId" (change)="onJobFilterChange()">
          <option [value]="undefined">All Jobs</option>
          <option *ngFor="let job of jobs" [value]="job.id">{{ job.title }}</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Statistics Summary -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="mb-0">Total Applications: <strong>{{ getTotalApplications() }}</strong></h5>
            </div>
            <div class="d-flex gap-3">
              <div *ngFor="let col of columns" class="text-center">
                <div class="h5 mb-0">{{ col.applications.length }}</div>
                <small class="text-muted">{{ col.label }}</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading pipeline...</p>
  </div>

  <!-- Kanban Board -->
  <div *ngIf="!loading" class="pipeline-board">
    <div class="row g-3">
      <div class="col-12 col-md-6 col-lg-4 col-xl-3" *ngFor="let column of columns">
        <div class="pipeline-column">
          <div class="pipeline-column-header">
            <h6 class="mb-0">{{ column.label }}</h6>
            <span class="badge bg-secondary">{{ column.applications.length }}</span>
          </div>
          <div
            cdkDropList
            [id]="'column-' + column.stage"
            [cdkDropListData]="column.applications"
            class="pipeline-column-content"
            (cdkDropListDropped)="onDrop($event)">
            <div
              *ngFor="let app of column.applications"
              cdkDrag
              class="pipeline-card"
              [routerLink]="['/applications', app.id]">
              <div class="pipeline-card-header">
                <strong>{{ app.candidateName }}</strong>
                <span [class]="getStatusBadgeClass(app.status)" class="badge badge-sm">
                  {{ getStatusText(app.status) }}
                </span>
              </div>
              <div class="pipeline-card-body">
                <div class="pipeline-card-job">{{ app.jobTitle }}</div>
                <div class="pipeline-card-meta">
                  <small class="text-muted">{{ app.appliedDate | date: 'MMM d' }}</small>
                  <span *ngIf="app.aiScore" [ngClass]="getScoreClass(app.aiScore)" class="pipeline-card-score">
                    {{ app.aiScore | number: '1.0-0' }}%
                  </span>
                </div>
              </div>
              <div class="cdk-drag-handle" *cdkDragHandle>
                <i class="fas fa-grip-vertical"></i>
              </div>
            </div>
            <div *ngIf="column.applications.length === 0" class="pipeline-empty">
              <i class="fas fa-inbox text-muted"></i>
              <p class="text-muted small mb-0">No applications</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Moving Indicator -->
  <div *ngIf="moving" class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" style="background: rgba(0,0,0,0.3); z-index: 9999;">
    <div class="card shadow-lg">
      <div class="card-body text-center p-4">
        <div class="spinner-border text-primary mb-3" role="status">
          <span class="visually-hidden">Moving...</span>
        </div>
        <p class="mb-0">Moving application...</p>
      </div>
    </div>
  </div>
</div>
